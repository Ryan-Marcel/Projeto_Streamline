@model Projeto_Dotnet8.Models.CriarPC_Sala;
@{
    ViewData["Title"] = "Criar Sala/Computador";
}

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/criarPC.css" />
    <link rel="stylesheet" href="~/css/header.css" />
</head>

<body>
    <partial name="_HeaderADM" />

    <div class="titulo">
        <div class="bg1">
            <h1>Criar Sala ou Computador</h1>
        </div>
        <div class="bg2"></div>
    </div>

    <section class="container">
        
        @* Mensagens de feedback *@
        @if (TempData["Sucesso"] != null)
        {
            <div class="alert alert-success">
                <span class="alert-icon">‚úì</span>
                @TempData["Sucesso"]
            </div>
        }
        
        @if (TempData["Erro"] != null)
        {
            <div class="alert alert-error">
                <span class="alert-icon">‚úó</span>
                @TempData["Erro"]
            </div>
        }

        @* Sistema de Abas *@
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-button active" onclick="switchTab('sala')" id="tab-sala">
                    <span class="tab-icon"></span>
                    Criar Sala
                </button>
                <button class="tab-button" onclick="switchTab('computador')" id="tab-computador">
                    <span class="tab-icon"></span>
                    Criar Computador
                </button>
            </div>

            @* Aba: Criar Sala *@
            <div class="tab-content active" id="content-sala">
                <div class="tab-content-inner">
                    <h3 class="tab-title">Nova Sala</h3>
                    <p class="tab-description">Preencha as informa√ß√µes abaixo para criar uma nova sala.</p>
                    
                    <form asp-controller="Computador" asp-action="CriarSala" method="post">
                        <div class="form-group">
                            <label for="novaSalaInput">
                                <span class="label-icon"></span>
                            Nome da Sala
                            </label>
                            <input 
                                asp-for="NovaSalaNum" 
                                class="form-control" 
                                id="novaSalaInput"
                                placeholder="Ex: Sala 101, Lab A, etc." 
                                required 
                            />
                            <span class="form-hint">Identifique a sala com um n√∫mero ou nome √∫nico</span>
                        </div>

                        <div class="button-group">
                            <button type="submit" class="btn btn-primary" id="btnCriarSala">
                                <span class="btn-icon">‚úì</span>
                                Criar Sala
                            </button>
                            <a asp-controller="Principal" asp-action="IndexADM" class="btn btn-secondary">
                                <span class="btn-icon">‚Üê</span>
                                Voltar
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            @* Aba: Criar Computador *@
            <div class="tab-content" id="content-computador">
                <div class="tab-content-inner">
                    <h3 class="tab-title">Novo Computador</h3>
                    <p class="tab-description">Preencha as informa√ß√µes abaixo para criar um novo computador.</p>
                    
                    <form asp-controller="Computador" asp-action="CriarComputador" method="post">
                        <div class="form-group">
                            <label for="nomeComputadorInput">
                                <span class="label-icon"></span>
                                Nome do Computador
                            </label>
                            <input 
                                asp-for="Computador.Nome" 
                                class="form-control" 
                                id="nomeComputadorInput"
                                placeholder="Ex: PC-01, Desktop A, etc." 
                                required 
                            />
                            <span class="form-hint">Identifique o computador com um nome √∫nico</span>
                        </div>

                        <div class="form-group">
                            <label for="salaSelect">
                                <span class="label-icon"></span>
                                Sala
                            </label>
                            <div class="select-wrapper">
                                <select asp-for="SalaSelecionadaId" class="form-control" id="salaSelect" required>
                                    <option value="">Selecione uma sala</option>
                                    @foreach (var sala in Model.Salas)
                                    {
                                        <option value="@sala.ID">@sala.Sala_Num</option>
                                    }
                                </select>
                                <span class="select-arrow">‚ñº</span>
                            </div>
                            <span class="form-hint">Escolha a sala onde o computador ser√° instalado</span>
                        </div>

                        <div class="button-group">
                            <button type="submit" class="btn btn-primary" id="btnCriarComputador">
                                <span class="btn-icon">‚úì</span>
                                Criar Computador
                            </button>
                            <a asp-controller="Principal" asp-action="IndexADM" class="btn btn-secondary">
                                <span class="btn-icon">‚Üê</span>
                                Voltar
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        @* Lista de Salas Existentes *@
        @if (Model.Salas != null && Model.Salas.Any())
        {
            <div class="salas-existentes">
                <h3 class="section-title">
                    <span class="title-icon">üìã</span>
                    Salas Existentes
                </h3>
                <div class="salas-grid">
                    @foreach (var sala in Model.Salas)
                    {
                        var computadores = Model.Salas
                            .Where(s => s.ID == sala.ID)
                            .SelectMany(s => s.Computadores ?? new List<ComputadorModels>())
                            .Count();
                        
                        <div class="sala-card">
                            <div class="sala-card-header">
                                <span class="sala-icon">üè´</span>
                                <strong>@sala.Sala_Num</strong>
                            </div>
                            <div class="sala-card-body">
                                <span class="sala-info">
                                    <span class="info-icon-small">üíª</span>
                                    @computadores computador@(computadores != 1 ? "es" : "")
                                </span>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </section>


    <script>
        // Sistema de Abas
        function switchTab(tabName) {
            // Remove active de todos os bot√µes e conte√∫dos
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Adiciona active no bot√£o e conte√∫do selecionado
            document.getElementById('tab-' + tabName).classList.add('active');
            document.getElementById('content-' + tabName).classList.add('active');
        }

        // Valida√ß√£o em tempo real - Criar Sala
        document.addEventListener('DOMContentLoaded', function() {
            const novaSalaInput = document.getElementById('novaSalaInput');
            const btnCriarSala = document.getElementById('btnCriarSala');

            if (novaSalaInput && btnCriarSala) {
                novaSalaInput.addEventListener('input', function() {
                    const isValid = this.value.trim() !== '';
                    btnCriarSala.disabled = !isValid;
                    btnCriarSala.style.opacity = isValid ? '1' : '0.6';
                });
            }

            // Valida√ß√£o em tempo real - Criar Computador
            const nomeComputadorInput = document.getElementById('nomeComputadorInput');
            const salaSelect = document.getElementById('salaSelect');
            const btnCriarComputador = document.getElementById('btnCriarComputador');

            function validateComputadorForm() {
                if (nomeComputadorInput && salaSelect && btnCriarComputador) {
                    const nomeValido = nomeComputadorInput.value.trim() !== '';
                    const salaValida = salaSelect.value !== '';
                    const isValid = nomeValido && salaValida;
                    
                    btnCriarComputador.disabled = !isValid;
                    btnCriarComputador.style.opacity = isValid ? '1' : '0.6';
                }
            }

            if (nomeComputadorInput) {
                nomeComputadorInput.addEventListener('input', validateComputadorForm);
            }
            if (salaSelect) {
                salaSelect.addEventListener('change', validateComputadorForm);
            }

            // Auto-hide alerts ap√≥s 5 segundos
            setTimeout(function() {
                const alerts = document.querySelectorAll('.alert');
                alerts.forEach(alert => {
                    alert.style.transition = 'opacity 0.5s';
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 500);
                });
            }, 5000);
        });
    </script>
</body>
</html>